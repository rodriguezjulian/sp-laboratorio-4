import{a as B}from"./chunk-2VMLSOPW.js";import{F as L}from"./chunk-FMY7REJO.js";import{Ab as I,Cb as f,Fc as v,Gc as P,Kc as S,Lc as E,Nb as j,Ob as o,Pb as d,Rb as F,Sa as H,Ua as s,Va as D,Wb as C,Xb as $,_b as x,ac as _,bc as z,ha as h,hb as m,lb as l,qa as M,ra as O,sb as t,tb as i,ub as N,vb as V,wb as A,xb as w,ya as k}from"./chunk-VJ2SRRAC.js";import{a as b,b as T,j as g}from"./chunk-4ZZIO3ZI.js";var J=()=>[];function K(c,a){c&1&&(t(0,"tr")(1,"td",4),o(2,"No hay registros de historia cl\xEDnica"),i()())}function Q(c,a){if(c&1&&(t(0,"tr")(1,"td"),o(2),x(3,"date"),i(),t(4,"td"),o(5),i(),t(6,"td"),o(7),i(),t(8,"td"),o(9),i(),t(10,"td"),o(11),i(),t(12,"td"),o(13),i(),t(14,"td"),o(15),i(),t(16,"td"),o(17),i()()),c&2){let e=a.$implicit,r=a.index,n=f();s(2),d(_(3,8,e.fecha,"shortDate")),s(3),d(e.altura),s(2),d(e.peso),s(2),d(e.presion),s(2),d(e.temperatura),s(2),d((n.datosDinamicosProcesados[r]==null?null:n.datosDinamicosProcesados[r][0])||"N/A"),s(2),d((n.datosDinamicosProcesados[r]==null?null:n.datosDinamicosProcesados[r][1])||"N/A"),s(2),d((n.datosDinamicosProcesados[r]==null?null:n.datosDinamicosProcesados[r][2])||"N/A")}}var y=class c{paciente;cerrarModal=new k;datosDinamicosProcesados=[];ngOnInit(){return g(this,null,function*(){console.log("Desde ver historia clinica",this.paciente),this.datosDinamicosProcesados=this.paciente.historiaClinica.map(a=>a.datosDinamicos.map(e=>`${e.clave}: ${e.valor}`)),console.log("Datos din\xE1micos procesados:",this.datosDinamicosProcesados)})}cerrar(){this.cerrarModal.emit()}pacienteSeleccionado=null;verHistoriaClinica(a){this.pacienteSeleccionado=a}cerrarHistoriaClinica(){this.pacienteSeleccionado=null}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=h({type:c,selectors:[["app-ver-historia-clinica"]],inputs:{paciente:"paciente"},outputs:{cerrarModal:"cerrarModal"},standalone:!0,features:[C],decls:25,vars:3,consts:[[1,"historia-clinica-container"],[1,"table","table-bordered","table-custom"],[4,"ngIf"],[4,"ngFor","ngForOf"],["colspan","8",1,"text-center"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"h3"),o(2,"Historia Cl\xEDnica"),i(),t(3,"table",1)(4,"thead")(5,"tr")(6,"th"),o(7,"Fecha"),i(),t(8,"th"),o(9,"Altura"),i(),t(10,"th"),o(11,"Peso"),i(),t(12,"th"),o(13,"Presi\xF3n"),i(),t(14,"th"),o(15,"Temperatura"),i(),t(16,"th"),o(17,"Dato 1"),i(),t(18,"th"),o(19,"Dato 2"),i(),t(20,"th"),o(21,"Dato 3"),i()()(),t(22,"tbody"),m(23,K,3,0,"tr",2)(24,Q,18,11,"tr",3),i()()()),e&2&&(s(23),l("ngIf",!(!(r.paciente==null||r.paciente.historiaClinica==null)&&r.paciente.historiaClinica.length)),s(),l("ngForOf",(r.paciente==null?null:r.paciente.historiaClinica)||$(2,J)))},dependencies:[E,v,P,S],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px;box-shadow:0 4px 6px #0000001a;background:#fff;border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px 15px;text-align:center;font-size:14px}thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;text-transform:uppercase;font-weight:700}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:#f9f9f9}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f1f1f1}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}td[_ngcontent-%COMP%]{border-bottom:1px solid #ddd}tfoot[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#f4f4f4;font-weight:700}.text-center[_ngcontent-%COMP%]{text-align:center}a[_ngcontent-%COMP%]{width:100%;height:100%}"]})};function W(c,a){if(c&1&&(t(0,"li"),o(1),x(2,"date"),i()),c&2){let e=a.$implicit;s(),F(" ",_(2,2,e.fecha,"shortDate")," - ",e.desde," ")}}function X(c,a){if(c&1){let e=w();t(0,"div",9),I("click",function(){let n=M(e).$implicit,p=f();return O(p.verHistoriaClinica(n))}),N(1,"img",10),t(2,"div",11)(3,"h5",12),o(4),i(),t(5,"div",13)(6,"strong"),o(7,"\xDAltimos turnos:"),i(),t(8,"ul"),m(9,W,3,5,"li",14),i()()()()}if(c&2){let e=a.$implicit;s(),l("src",e.urlFotoPerfil||"assets/default-avatar.png",H),s(3),F("",e.nombre," ",e.apellido,""),s(5),l("ngForOf",e.ultimosTurnos)}}function Y(c,a){if(c&1){let e=w();V(0),t(1,"app-ver-historia-clinica",15),I("cerrarModal",function(){M(e);let n=f();return O(n.cerrarHistoriaClinica())}),i(),A()}if(c&2){let e=f();s(),l("paciente",e.pacienteSeleccionado)}}function Z(c,a){c&1&&(t(0,"div",16)(1,"p"),o(2,"Selecciona un paciente para ver su historia cl\xEDnica."),i()())}var R=class c{constructor(a,e){this.firestoreService=a;this.auth=e}pacientes=[];especialistaLogueado;pacienteSeleccionado=null;ngOnInit(){return g(this,null,function*(){try{this.especialistaLogueado=yield this.auth.obtenerUsuarioActual(),console.log("Especialista logueado en este momento",this.especialistaLogueado.uid);let a=yield this.firestoreService.getCollection("turnos",{where:[{field:"uidEspecialista",op:"==",value:this.especialistaLogueado.uid},{field:"estado",op:"==",value:"Realizado"}]});console.log("Turnos obtenidos: ",a);let e=yield this.firestoreService.getPacientes(),r={};a.forEach(n=>{if(!r[n.uidPaciente]){let p=e.find(u=>u.id===n.uidPaciente);r[n.uidPaciente]=T(b({},p),{ultimosTurnos:[],historiaClinica:[]})}r[n.uidPaciente].ultimosTurnos.push({fecha:n.fecha,desde:n.desde}),n.historiaClinica&&r[n.uidPaciente].historiaClinica.push(b({fecha:n.fecha},n.historiaClinica))}),console.log("Pacientes map: ",r),this.pacientes=Object.values(r).map(n=>(n.ultimosTurnos=n.ultimosTurnos.sort((p,u)=>new Date(u.fecha).getTime()-new Date(p.fecha).getTime()).slice(0,3),n.historiaClinica&&n.historiaClinica.sort((p,u)=>new Date(u.fecha).getTime()-new Date(p.fecha).getTime()),n)),console.log("Pacientes cargados: ",this.pacientes)}catch(a){console.error("Error al cargar los pacientes:",a)}})}verHistoriaClinica(a){this.pacienteSeleccionado=a}cerrarHistoriaClinica(){this.pacienteSeleccionado=null}static \u0275fac=function(e){return new(e||c)(D(L),D(B))};static \u0275cmp=h({type:c,selectors:[["app-pacientes-para-especialistas"]],inputs:{pacientes:"pacientes"},standalone:!0,features:[C],decls:11,vars:3,consts:[["noSeleccionado",""],[1,"fondo"],[1,"container-fluid"],[1,"text-center"],[1,"row"],[1,"col-12","col-md-4","pacientes-col"],["class","card mb-4",3,"click",4,"ngFor","ngForOf"],[1,"col-12","col-md-8","historia-col"],[4,"ngIf","ngIfElse"],[1,"card","mb-4",3,"click"],["alt","Foto del paciente",1,"card-img-top",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[4,"ngFor","ngForOf"],[3,"cerrarModal","paciente"],[1,"no-seleccionado"]],template:function(e,r){if(e&1&&(t(0,"div",1)(1,"div",2)(2,"h2",3),o(3,"Pacientes Atendidos"),i(),t(4,"div",4)(5,"div",5),m(6,X,10,4,"div",6),i(),t(7,"div",7),m(8,Y,2,1,"ng-container",8)(9,Z,3,0,"ng-template",null,0,z),i()()()()),e&2){let n=j(10);s(6),l("ngForOf",r.pacientes),s(2),l("ngIf",r.pacienteSeleccionado)("ngIfElse",n)}},dependencies:[E,v,P,S,y],styles:[".fondo[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;margin:0;padding:20px;background:linear-gradient(45deg,gold,#e48080);background-attachment:fixed;background-size:cover;background-repeat:no-repeat}.container-fluid[_ngcontent-%COMP%]{width:100%}.pacientes-col[_ngcontent-%COMP%]{overflow-y:auto;height:80vh}.pacientes-col[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{cursor:pointer;border:1px solid #ddd;transition:transform .2s ease}.pacientes-col[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.card-img-top[_ngcontent-%COMP%]{width:100%;height:150px;object-fit:cover;border-radius:8px 8px 0 0;box-shadow:0 4px 6px #0000001a}.historia-col[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:80vh;background:#fffc;border-radius:12px;padding:20px;box-shadow:0 4px 10px #0003}.no-seleccionado[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem;color:#666}"]})};export{R as PacientesParaEspecialistasComponent};
