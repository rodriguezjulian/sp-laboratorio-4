import{a as K}from"./chunk-OLWY7DYE.js";import{c as U,d as T,f as y,i as E}from"./chunk-EJJBCPAK.js";import{F as J,u as z,z as G}from"./chunk-JRXB4MSQ.js";import{$b as M,Bb as D,Eb as _,Gb as p,Jc as N,Kc as L,Lc as j,Qc as Y,Sb as l,Ub as $,Vb as v,Wa as d,Xa as w,_b as P,ac as A,bc as H,ia as O,kb as x,ob as h,ra as f,sa as g,tb as V,wb as c,xb as s}from"./chunk-SLHCDPS3.js";import{a as I,b as F,g as B,j as b}from"./chunk-4ZZIO3ZI.js";var C=B(K());var Q=r=>({"btn-selected":r}),R=()=>[],W=(r,n)=>({"btn-primary":r,"btn-secondary":n});function X(r,n){if(r&1){let e=D();c(0,"button",7),_("click",function(){f(e);let i=p();return g(i.cambiarSemana(!1))}),l(1,"Semana Actual"),s(),c(2,"button",8),_("click",function(){f(e);let i=p();return g(i.cambiarSemana(!0))}),l(3,"Pr\xF3xima Semana"),s()}}function Z(r,n){if(r&1){let e=D();c(0,"button",9),_("click",function(){f(e);let i=p();return g(i.cambiarSemana(!1))}),l(1,"Semana Actual"),s(),c(2,"button",10),_("click",function(){f(e);let i=p();return g(i.cambiarSemana(!0))}),l(3,"Pr\xF3xima Semana"),s()}}function ee(r,n){r&1&&(c(0,"span",17),l(1,"(Ocupado)"),s())}function ie(r,n){if(r&1){let e=D();c(0,"li")(1,"button",15),_("click",function(){let i=f(e).$implicit,a=p().$implicit,o=p();return g(o.confirmarTurno(a.dia,i.desde,i.hasta,a.fecha))}),l(2),x(3,ee,2,0,"span",16),s()()}if(r&2){let e=n.$implicit;d(),h("ngClass",H(5,W,e.estado,!e.estado))("disabled",!e.estado),d(),v(" ",e.desde," - ",e.hasta," "),d(),h("ngIf",!e.estado)}}function te(r,n){if(r&1){let e=D();c(0,"div",11)(1,"button",12),_("click",function(){let i=f(e).$implicit,a=p();return g(a.seleccionarDia(i.fecha))}),l(2),s(),c(3,"ul",13),x(4,ie,4,8,"li",14),s()()}if(r&2){let e=n.$implicit,t=p();d(),h("ngClass",A(4,Q,t.diaSeleccionado===e.fecha)),d(),v(" ",e.dia," ",e.fecha," "),d(2),h("ngForOf",t.horariosDisponibles[e.dia]||M(6,R))}}var q=class r{constructor(n,e){this.firestoreService=n;this.auth=e}especialista;especialidad;paciente;usuarioLogueado=null;horariosDisponibles={};diasDisponibles=[];mostrandoProximaSemana=!1;diaSeleccionado=null;ngOnInit(){return b(this,null,function*(){G(this.auth,n=>b(this,null,function*(){n&&(this.usuarioLogueado=n,this.configurarDiasDisponibles())}))})}seleccionarDia(n){return b(this,null,function*(){let e=n;this.diaSeleccionado=null,yield this.cargarHorariosDisponibles(),this.cargarHorariosDisponibles(),this.diaSeleccionado=e,yield this.cargarHorariosDisponibles(),this.cargarHorariosDisponibles()})}configurarDiasDisponibles(){if(!this.especialista||!this.especialidad){console.error("Especialista o especialidad no definidos");return}let n=["Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado","Domingo"],e=new Date,t=e.getDay()===0?6:e.getDay()-1,i=this.mostrandoProximaSemana?new Date(e.setDate(e.getDate()+7)):new Date(e),a=Object.keys(this.especialista.horarios).filter(o=>this.especialista.horarios[o].especialidad===this.especialidad.id);this.diasDisponibles=a.map(o=>{let u=n.indexOf(o),m=new Date(i);return m.setDate(m.getDate()+(u-t+7)%7),{dia:o,fecha:m.toISOString().split("T")[0]}}).sort((o,u)=>new Date(o.fecha).getTime()-new Date(u.fecha).getTime())}cargarHorariosDisponibles(){return b(this,null,function*(){if(!this.especialista||!this.especialidad){C.default.fire("Error","Datos insuficientes para cargar los horarios.","error");return}let n=this.especialista.horarios,e=yield this.firestoreService.getCollection("turnos",{where:[{field:"uidEspecialista",op:"==",value:this.especialista.id},{field:"uidEspecialidad",op:"==",value:this.especialidad.id}]}),t={};e.forEach(i=>{let a=`${i.dia}_${i.fecha}`;t[a]||(t[a]=[]),t[a].push({desde:i.desde,hasta:i.hasta})}),this.diasDisponibles.forEach(({dia:i,fecha:a})=>{if(this.diaSeleccionado===a){let o=n[i];if(o&&o.especialidad.includes(this.especialidad.id)){let m=this.generarIntervalosDeMediaHora(o.desde,o.hasta).map(S=>F(I({},S),{estado:!t[`${i}_${a}`]?.some(k=>k.desde===S.desde&&k.hasta===S.hasta)}));this.horariosDisponibles[i]=m}else this.horariosDisponibles[i]=[]}})})}confirmarTurno(n,e,t,i){return b(this,null,function*(){if(!this.usuarioLogueado){C.default.fire("Error","Debe iniciar sesi\xF3n para reservar un turno.","error");return}console.log("xd ",this.usuarioLogueado.uid);let a={uidEspecialista:this.especialista.id,uidEspecialidad:this.especialidad.id,uidPaciente:this.paciente?.id??this.usuarioLogueado.uid,dia:n,desde:e,hasta:t,fecha:i,estado:"pendiente",creadoEn:new Date,comentario:"",encuesta:"",calificacion:""};try{yield this.firestoreService.createDocument("turnos",a),C.default.fire("Turno Guardado",`Tu turno ha sido guardado exitosamente para el ${n}, ${i} de ${e} a ${t}.`,"success"),yield this.cargarHorariosDisponibles()}catch(o){console.error("Error al guardar el turno:",o),C.default.fire("Error","No se pudo guardar el turno. Intente nuevamente.","error")}})}generarIntervalosDeMediaHora(n,e){let t=[],[i,a]=n.split(":").map(Number),[o,u]=e.split(":").map(Number);for(;i<o||i===o&&a<u;){let m=`${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`;a+=30,a===60&&(a=0,i++);let S=`${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`;(i<o||i===o&&a<=u)&&t.push({desde:m,hasta:S,estado:!0})}return t}cambiarSemana(n){this.diaSeleccionado=null,this.horariosDisponibles={},this.mostrandoProximaSemana=n,this.configurarDiasDisponibles(),this.cargarHorariosDisponibles()}static \u0275fac=function(e){return new(e||r)(w(J),w(z))};static \u0275cmp=O({type:r,selectors:[["app-generar-turno"]],inputs:{especialista:"especialista",especialidad:"especialidad",paciente:"paciente"},standalone:!0,features:[P],decls:16,vars:6,consts:[[1,"fondo"],[1,"container"],[1,"text-center","mt-4"],[1,"especialista-info"],[1,"text-center","mb-3"],[1,"row","text-center"],["class","col-md-2",4,"ngFor","ngForOf"],["disabled","",1,"btn","btn-primary","mx-2",3,"click"],[1,"pointer","btn","btn-secondary",3,"click"],[1,"pointer","btn","btn-secondary","mx-2",3,"click"],["disabled","",1,"btn","btn-primary",3,"click"],[1,"col-md-2"],[1,"btn","btn-dia",3,"click","ngClass"],[1,"list-unstyled"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","my-2",3,"click","ngClass","disabled"],["class","text-muted ocupado",4,"ngIf"],[1,"text-muted","ocupado"]],template:function(e,t){e&1&&(c(0,"section",0)(1,"div",1)(2,"h2",2),l(3,"Turnos Disponibles"),s(),c(4,"div",3)(5,"h3"),l(6),s(),c(7,"p")(8,"strong"),l(9,"Especialidad:"),s(),l(10),s()(),c(11,"div",4),x(12,X,4,0)(13,Z,4,0),s(),c(14,"div",5),x(15,te,5,7,"div",6),s()()()),e&2&&(h("@flipIn",void 0),d(6),v("",t.especialista==null?null:t.especialista.nombre," ",t.especialista==null?null:t.especialista.apellido,""),d(4),$(" ",t.especialidad==null?null:t.especialidad.descripcion,""),d(2),V(t.mostrandoProximaSemana?13:12),d(3),h("ngForOf",t.diasDisponibles))},dependencies:[Y,N,L,j],styles:[".btn-secondary[_ngcontent-%COMP%]{background-color:#fa1a1a;color:#fff;cursor:not-allowed}.ocupado[_ngcontent-%COMP%]{color:#fff!important}.fondo[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;align-items:center;margin:0;padding:0;background:linear-gradient(45deg,gold,#e48080);background-attachment:fixed;background-size:cover;background-repeat:no-repeat}.btn-dia[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;width:100%;height:50px;margin-bottom:10px}.btn-dia.btn-selected[_ngcontent-%COMP%]{background-color:#0056b3;font-weight:700}.pointer[_ngcontent-%COMP%]{cursor:pointer}"],data:{animation:[U("flipIn",[E(":enter",[y({transform:"rotateY(-90deg)",opacity:0}),T("1000ms ease-out",y({transform:"rotateY(0)",opacity:1}))]),E(":leave",[T("800ms ease-in",y({transform:"rotateY(90deg)",opacity:0}))])])]}})};export{q as a};
