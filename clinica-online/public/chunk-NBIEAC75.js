import{a as B}from"./chunk-OLWY7DYE.js";import{a as j}from"./chunk-7FG5ZD4D.js";import{F as V,u as L,z as k}from"./chunk-JRXB4MSQ.js";import{Bb as I,Eb as m,Gb as d,Kb as E,Kc as T,Qc as G,Sb as s,Tb as y,Ua as x,Ub as P,Vb as F,Wa as n,Xa as C,_b as $,cc as D,dc as H,ia as M,kb as f,la as w,ob as c,ra as _,sa as b,wb as r,xb as o,yb as v}from"./chunk-SLHCDPS3.js";import{a as O,g as A,j as u}from"./chunk-4ZZIO3ZI.js";var h=A(B());var S=class l{transform(i){return!i||i.length<4?i:i.slice(0,4).replace(/./g,"*")+i.slice(4)}static \u0275fac=function(t){return new(t||l)};static \u0275pipe=w({name:"ocultarPrimeras",type:l,pure:!0,standalone:!0})};function U(l,i){if(l&1&&(r(0,"option",17),s(1),o()),l&2){let t=i.$implicit,e=d().$implicit,a=d();c("value",t.id)("selected",(a.horariosPorDia[e]==null?null:a.horariosPorDia[e].especialidad)===t.id),n(),P(" ",t.descripcion," ")}}function J(l,i){if(l&1&&(r(0,"option",18),s(1),o()),l&2){let t=i.$implicit,e=d().$implicit,a=d();c("selected",(a.horariosPorDia[e]==null?null:a.horariosPorDia[e].desde)===t),n(),P(" ",t," ")}}function q(l,i){if(l&1&&(r(0,"option",18),s(1),o()),l&2){let t=i.$implicit,e=d().$implicit,a=d();c("selected",(a.horariosPorDia[e]==null?null:a.horariosPorDia[e].hasta)===t),n(),P(" ",t," ")}}function K(l,i){if(l&1){let t=I();r(0,"tr")(1,"td"),s(2),o(),r(3,"td")(4,"select",13),m("change",function(a){let p=_(t).$implicit,g=d();return b(g.seleccionarEspecialidad(p,a))}),r(5,"option",14),s(6,"Seleccione una especialidad"),o(),f(7,U,2,3,"option",15),o()(),r(8,"td")(9,"select",13),m("change",function(a){let p=_(t).$implicit,g=d();return b(g.cambiarHorario(p,"desde",a))}),r(10,"option",14),s(11,"Desde"),o(),f(12,J,2,2,"option",16),o()(),r(13,"td")(14,"select",13),m("change",function(a){let p=_(t).$implicit,g=d();return b(g.cambiarHorario(p,"hasta",a))}),r(15,"option",14),s(16,"Hasta"),o(),f(17,q,2,2,"option",16),o()()()}if(l&2){let t=i.$implicit,e=d();n(2),y(t),n(2),E("id","especialidad-",t,""),n(3),c("ngForOf",e.especialidades),n(2),E("id","desde-",t,""),n(3),c("ngForOf",e.turnos),n(2),E("id","hasta-",t,""),n(3),c("ngForOf",e.turnos)}}var z=class l{constructor(i,t,e){this.firestoreService=i;this.auth=t;this.loader=e}especialista;especialidades=[];mostrarDatos=!1;dias=["Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"];turnos=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00"];horariosPorDia={};huboCambios=!1;usuarioLogueado=null;toggleMostrarDatos(){this.mostrarDatos=!this.mostrarDatos}ngOnInit(){return u(this,null,function*(){this.loader.setLoader(!0),k(this.auth,i=>u(this,null,function*(){i?(this.usuarioLogueado=i,yield this.cargarEspecialista(),yield this.cargarEspecialidades()):this.usuarioLogueado=null})),this.loader.setLoader(!1)})}cargarEspecialista(){return u(this,null,function*(){if(!this.usuarioLogueado)return;let i=this.usuarioLogueado.uid,t=yield this.firestoreService.getDocument(`especialista/${i}`);this.especialista=t.exists()?t.data():null,this.especialista?.horarios&&(this.horariosPorDia=this.especialista.horarios,this.actualizarCamposHorarios())})}cargarEspecialidades(){return u(this,null,function*(){if(!this.especialista?.especialidad)return;let i=this.especialista.especialidad,e=(yield this.firestoreService.getDocuments("especialidades")).docs.map(a=>O({id:a.id},a.data()));this.especialidades=e.filter(a=>i.includes(a.id))})}actualizarCamposHorarios(){for(let i of this.dias){let t=this.horariosPorDia[i];if(t){let e=document.getElementById(`desde-${i}`);e&&t.desde&&(e.value=t.desde);let a=document.getElementById(`hasta-${i}`);a&&t.hasta&&(a.value=t.hasta);let p=document.getElementById(`especialidad-${i}`);p&&t.especialidad&&(p.value=t.especialidad)}}}seleccionarEspecialidad(i,t){let e=t.target.value;this.horariosPorDia[i]=this.horariosPorDia[i]||{},this.horariosPorDia[i].especialidad=e,this.huboCambios=!0}cambiarHorario(i,t,e){let a=e.target.value;this.horariosPorDia[i]=this.horariosPorDia[i]||{},this.horariosPorDia[i][t]=a,this.huboCambios=!0}guardarCambios(){return u(this,null,function*(){try{for(let i of this.dias){let t=this.horariosPorDia[i];if(t){if(!t.desde||!t.hasta){yield h.default.fire({icon:"error",title:"Error",text:`Debe seleccionar horarios v\xE1lidos para el d\xEDa ${i}`});return}let e=this.convertirHoraAEntero(t.desde),a=this.convertirHoraAEntero(t.hasta);if(a<=e||a-e<.5){yield h.default.fire({icon:"error",title:"Error",text:`El horario "Hasta" debe ser al menos 30 minutos despu\xE9s del horario "Desde" para el d\xEDa ${i}.`});return}if(!t.especialidad){yield h.default.fire({icon:"error",title:"Error",text:`Debe seleccionar una especialidad para el d\xEDa ${i}`});return}}}yield this.firestoreService.updateDocument(`especialista/${this.especialista.id}`,{horarios:this.horariosPorDia}),this.huboCambios=!1,yield h.default.fire({icon:"success",title:"Guardado",text:"Horarios y especialidades guardados exitosamente"})}catch(i){console.error("Error al guardar cambios:",i),yield h.default.fire({icon:"error",title:"Error",text:"Hubo un problema al guardar los cambios"})}})}convertirHoraAEntero(i){let[t,e]=i.split(":").map(Number);return t+e/60}static \u0275fac=function(t){return new(t||l)(C(V),C(L),C(j))};static \u0275cmp=M({type:l,selectors:[["app-gestion-horarios"]],standalone:!0,features:[$],decls:43,vars:13,consts:[[1,"fondo"],[1,"container"],[1,"text-center","mt-4"],[1,"especialista-info","d-flex","align-items-center","justify-content-center","my-4"],[1,"foto-container","text-center"],["alt","Foto del Especialista",1,"perfil-img",3,"src"],[1,"datos-container","ms-4"],[1,"btn","btn-sm","ms-2",3,"click"],["alt","Toggle View",2,"width","20px","height","20px",3,"src"],[1,"horarios-container"],[1,"table","table-bordered"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary","px-4",3,"click","disabled"],[1,"form-select",3,"change","id"],["value","","disabled","","selected",""],[3,"value","selected",4,"ngFor","ngForOf"],[3,"selected",4,"ngFor","ngForOf"],[3,"value","selected"],[3,"selected"]],template:function(t,e){t&1&&(r(0,"section",0)(1,"div",1)(2,"h2",2),s(3,"Gesti\xF3n de Horarios y Especialidades"),o(),r(4,"div",3)(5,"div",4),v(6,"img",5),o(),r(7,"div",6)(8,"h3"),s(9),o(),r(10,"p")(11,"strong"),s(12,"DNI: "),o(),r(13,"span"),s(14),D(15,"ocultarPrimeras"),o(),r(16,"button",7),m("click",function(){return e.toggleMostrarDatos()}),v(17,"img",8),o()(),r(18,"p")(19,"strong"),s(20,"Correo: "),o(),r(21,"span"),s(22),D(23,"ocultarPrimeras"),o(),r(24,"button",7),m("click",function(){return e.toggleMostrarDatos()}),v(25,"img",8),o()()()(),r(26,"div",9)(27,"table",10)(28,"thead")(29,"tr")(30,"th"),s(31,"D\xEDa"),o(),r(32,"th"),s(33,"Especialidad"),o(),r(34,"th"),s(35,"Desde"),o(),r(36,"th"),s(37,"Hasta"),o()()(),r(38,"tbody"),f(39,K,18,10,"tr",11),o()()(),r(40,"div",2)(41,"button",12),m("click",function(){return e.guardarCambios()}),s(42," Guardar Cambios "),o()()()()),t&2&&(n(6),c("src",(e.especialista==null?null:e.especialista.urlFotoPerfil)||"https://via.placeholder.com/150",x),n(3),F("",e.especialista==null?null:e.especialista.nombre," ",e.especialista==null?null:e.especialista.apellido,""),n(5),y(e.mostrarDatos?e.especialista==null?null:e.especialista.dni:H(15,9,e.especialista==null?null:e.especialista.dni)),n(3),c("src",e.mostrarDatos?"../assets/1.png":"../assets/2.png",x),n(5),y(e.mostrarDatos?e.especialista==null?null:e.especialista.correo:H(23,11,e.especialista==null?null:e.especialista.correo)),n(3),c("src",e.mostrarDatos?"../assets/1.png":"../assets/2.png",x),n(14),c("ngForOf",e.dias),n(2),c("disabled",!e.huboCambios))},dependencies:[G,T,S],styles:[".fondo[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(45deg,#ffde59,#ff6b6b);padding:20px}.perfil-img[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;margin-bottom:15px}.horarios-container[_ngcontent-%COMP%]{margin-top:20px}.fondo[_ngcontent-%COMP%]{padding:20px;background-color:#f8f9fa}.especialista-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.foto-container[_ngcontent-%COMP%]   img.perfil-img[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;object-fit:cover}.datos-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.datos-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.5rem}.datos-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;font-size:1rem}.table[_ngcontent-%COMP%]{margin-top:20px;background:#fff}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center;vertical-align:middle}"]})};export{z as GestionHorariosComponent};
