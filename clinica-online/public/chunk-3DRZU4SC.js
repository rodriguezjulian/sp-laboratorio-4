import{a as ce}from"./chunk-W3H3FZ3L.js";import{b as ee,f as te,j as ne,s as ie}from"./chunk-LDTLK62Q.js";import{a as me}from"./chunk-OLWY7DYE.js";import{a as se}from"./chunk-7FG5ZD4D.js";import{c as Z,d as R,f as M,i as F}from"./chunk-EJJBCPAK.js";import{F as re,u as ae,z as oe}from"./chunk-JRXB4MSQ.js";import{Ab as L,Bb as v,Eb as C,Gb as m,Kc as U,Lc as J,Oc as K,Qc as Q,Sb as c,Tb as A,Ub as H,Vb as N,Wa as d,Wb as j,Xa as D,Xb as q,Yb as G,_b as W,cc as z,dc as X,ec as Y,ia as $,kb as y,la as O,ob as p,ra as h,sa as x,tb as B,wb as r,xb as s,zb as k}from"./chunk-SLHCDPS3.js";import{a as I,b as V,g as de,j as S}from"./chunk-4ZZIO3ZI.js";var b=de(me());var P=class a{transform(t,e){if(!e)return t;let n=e.toLowerCase();return t.filter(i=>{console.log("desde pipe ",t);let o=i.nombre.toLowerCase().includes(n),l=i.especialidad.toLowerCase().includes(n),u=i.historiaClinica?.altura.toLowerCase().includes(n),T=i.historiaClinica?.peso.toLowerCase().includes(n),E=i.historiaClinica?.presion.toLowerCase().includes(n),_=i.historiaClinica?.temperatura.toLowerCase().includes(n),g=i.historiaClinica?.datosDinamicos?.some(f=>f.clave.toLowerCase().includes(n)||f.valor.toLowerCase().includes(n));return o||l||g||u||T||E||_})}static \u0275fac=function(e){return new(e||a)};static \u0275pipe=O({name:"buscarPacienteEspecialidad",type:a,pure:!0,standalone:!0})};function pe(a,t){if(a&1){let e=v();r(0,"button",16),C("click",function(){h(e);let i=m(2).$implicit,o=m(2);return x(o.abrirHistoriaClinica(i))}),c(1," Historia Cl\xEDnica "),s()}}function _e(a,t){a&1&&(r(0,"button",15),c(1," Historia completada "),s())}function ge(a,t){if(a&1&&y(0,pe,2,0,"button",14)(1,_e,2,0,"button",15),a&2){let e=m().$implicit;B(e.historiaClinica?1:0)}}function fe(a,t){if(a&1){let e=v();r(0,"button",17),C("click",function(){h(e);let i=m().$implicit,o=m(2);return x(o.verResenia(i))}),c(1," Ver Rese\xF1a "),s()}}function be(a,t){if(a&1){let e=v();r(0,"button",18),C("click",function(){h(e);let i=m().$implicit,o=m(2);return x(o.verDiagnostico(i))}),c(1," Diagn\xF3stico "),s()}}function Ce(a,t){if(a&1){let e=v();r(0,"button",20),C("click",function(){h(e);let i=m(2).$implicit,o=m(2);return x(o.abrirModal("Finalizar",i))}),c(1," Finalizar "),s()}}function he(a,t){if(a&1){let e=v();r(0,"button",24),C("click",function(){h(e);let i=m(3).$implicit,o=m(2);return x(o.abrirModal("Cancelar",i))}),c(1," Cancelar "),s()}}function xe(a,t){if(a&1){let e=v();r(0,"button",25),C("click",function(){h(e);let i=m(3).$implicit,o=m(2);return x(o.abrirModal("Rechazar",i))}),c(1," Rechazar "),s()}}function ve(a,t){if(a&1){let e=v();r(0,"button",26),C("click",function(){h(e);let i=m(3).$implicit,o=m(2);return x(o.actualizarEstadoTurno(i,"Aceptado"))}),c(1," Aceptar "),s()}}function ye(a,t){if(a&1&&(k(0),y(1,he,2,0,"button",21)(2,xe,2,0,"button",22)(3,ve,2,0,"button",23),L()),a&2){let e=m(2).$implicit;d(),p("ngIf",e.estado!=="Realizado"),d(),p("ngIf",e.estado!=="Realizado"),d(),p("ngIf",e.estado!=="Realizado")}}function Te(a,t){if(a&1&&(k(0),y(1,Ce,2,0,"button",19)(2,ye,4,3,"ng-container",10),L()),a&2){let e=m().$implicit;d(),p("ngIf",e.estado==="Aceptado"),d(),p("ngIf",e.estado!=="Aceptado"&&e.estado!=="Realizado")}}function Ee(a,t){if(a&1&&(r(0,"tr")(1,"td"),c(2),s(),r(3,"td"),c(4),s(),r(5,"td"),c(6),s(),r(7,"td"),c(8),s(),r(9,"td"),c(10),s(),r(11,"td",11)(12,"strong"),c(13),z(14,"titlecase"),s()(),r(15,"td"),y(16,ge,2,1)(17,fe,2,0,"button",12)(18,be,2,0,"button",13)(19,Te,3,2,"ng-container",10),s()()),a&2){let e=t.$implicit,n=m().$implicit;d(2),A(e.nombre),d(2),A(e.especialidad),d(2),A(n.dia),d(2),A(n.fecha),d(2),N("",e.desde," - ",e.hasta,""),d(),p("EstadoTurnoColor",e.estado),d(2),H(" ",X(14,12,e.estado)," "),d(3),B(e.estado==="Realizado"?16:-1),d(),p("ngIf",(e.estado==="Cancelado"||e.estado==="Rechazado")&&(e.comentario==null?null:e.comentario.length)>0),d(),p("ngIf",e.estado==="Realizado"),d(),p("ngIf",e.estado!=="Cancelado"&&e.estado!=="Rechazado")}}function Se(a,t){if(a&1&&(k(0),y(1,Ee,20,14,"tr",9),z(2,"buscarPacienteEspecialidad"),L()),a&2){let e=t.$implicit,n=m();d(),p("ngForOf",Y(2,1,e.turnos,n.buscar))}}function we(a,t){a&1&&(r(0,"tr")(1,"td",27),c(2,"No hay turnos asignados para esta semana."),s()())}var le=class a{constructor(t,e,n){this.firestoreService=t;this.auth=e;this.loader=n}usuarioLogueado=null;buscar="";turnos=[];turnosAsignados=[];BuscarEspecialistaEspecialidad="";diasDisponibles=[];mostrandoProximaSemana=!1;diasSemana=["Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"];especialidades=[];especialidadSeleccionada=null;ngOnInit(){return S(this,null,function*(){this.loader.setLoader(!0),oe(this.auth,t=>S(this,null,function*(){t&&(this.usuarioLogueado=t,yield this.cargarEspecialidades(),this.configurarDiasDisponibles(),yield this.cargarTurnosAsignados(),this.loader.setLoader(!1))}))})}cargarEspecialidades(){return S(this,null,function*(){if(this.usuarioLogueado)try{let t=yield this.firestoreService.getDocument(`especialista/${this.usuarioLogueado.uid}`),e=t.exists()?t.data():null;if(e?.especialidad){let i=(yield this.firestoreService.getCollection("especialidades")).map(o=>I({id:o.id},o));this.especialidades=i.filter(o=>e.especialidad.includes(o.id)),this.especialidades.length>0&&(this.especialidadSeleccionada=this.especialidades[0].id),console.log("carga especia ",this.especialidades)}}catch(t){console.error("Error al cargar especialidades:",t)}})}configurarDiasDisponibles(){let t=new Date,e=t.getDay(),n=this.mostrandoProximaSemana?new Date(t.setDate(t.getDate()+(7-e+1))):new Date(t.setDate(t.getDate()-e+1));this.diasDisponibles=this.diasSemana.map((i,o)=>{let l=new Date(n);return l.setDate(n.getDate()+o),{dia:i,fecha:l.toISOString().split("T")[0],turnos:[]}})}cargarTurnosAsignados(){return S(this,null,function*(){if(this.usuarioLogueado)try{let e=(yield this.firestoreService.getCollection("turnos",{where:[{field:"uidEspecialista",op:"==",value:this.usuarioLogueado.uid}]})).map(l=>l),n=yield this.firestoreService.getPacientes(),i=yield this.firestoreService.getEspecialidades();e.forEach(l=>{n.forEach(u=>{l.uidPaciente==u.id&&(l.nombre=u.nombre+" "+u.apellido)}),i.forEach(u=>{l.uidEspecialidad==u.id&&(l.especialidad=u.descripcion)})}),console.log("a ver como quedan asi los turnos :",e);let o={};e.forEach(l=>{o[l.fecha]||(o[l.fecha]=[]),o[l.fecha].push(l)}),Object.keys(o).forEach(l=>{o[l].sort((u,T)=>{let E=u.desde,_=T.desde;return E.localeCompare(_)})}),this.diasDisponibles.forEach(l=>{l.turnos=o[l.fecha]||[]})}catch(t){console.error("Error al cargar turnos asignados:",t),b.default.fire("Error","Hubo un problema al cargar los turnos asignados.","error")}})}cambiarSemana(t){this.mostrandoProximaSemana=t,this.configurarDiasDisponibles(),this.cargarTurnosAsignados()}verResenia(t){b.default.fire({title:"Rese\xF1a del Turno",text:t.comentario,icon:"info",confirmButtonText:"Cerrar"})}verDiagnostico(t){b.default.fire({title:"Diagn\xF3stico",text:t.diagonostico,icon:"info",confirmButtonText:"Cerrar"})}tieneTurnosAsignados(){return this.diasDisponibles.some(t=>t.turnos.length>0)}abrirModal(t,e){b.default.fire({title:`${t} Turno`,input:"textarea",inputLabel:`Escribe un comentario para ${t.toLowerCase()} el turno`,inputPlaceholder:"Escribe tu comentario aqu\xED...",showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar"}).then(n=>{if(n.isConfirmed&&n.value){let i=n.value.trim();t==="Cancelar"?this.actualizarEstadoTurno(e,"Cancelado",i):t==="Rechazar"?this.actualizarEstadoTurno(e,"Rechazado",i):t==="Finalizar"&&this.actualizarEstadoTurno(e,"Realizado",i)}})}actualizarEstadoTurno(t,e,n=""){return S(this,null,function*(){try{let i;e=="Realizado"?i=V(I({},t),{estado:e,diagonostico:n}):i=V(I({},t),{estado:e,comentario:n||t.comentario}),console.log("todo bien.",i),yield this.firestoreService.updateDocument(`turnos/${t.id}`,i),console.log("despues del update."),b.default.fire("\xC9xito",`El turno fue ${e.toLowerCase()} exitosamente.`,"success"),this.cargarTurnosAsignados()}catch(i){console.error(`Error al ${e.toLowerCase()} el turno:`,i),b.default.fire("Error",`No se pudo ${e.toLowerCase()} el turno. Intenta de nuevo.`,"error")}})}abrirHistoriaClinica(t){let e="",n="",i="",o="",l=50,u="",T=!1,E=[];b.default.fire({title:"Historia Cl\xEDnica",html:`
        <div class="container">
          <div class="mb-3">
            <label class="form-label fw-bold">Altura (cm):</label>
            <input type="number" id="altura" class="form-control" />
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Peso (kg):</label>
            <input type="number" id="peso" class="form-control" />
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Temperatura (\xB0C):</label>
            <input type="number" id="temperatura" class="form-control" />
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Presi\xF3n arterial:</label>
            <input type="text" id="presion" class="form-control" />
          </div>
  
          <!-- Control de rango -->
          <div class="mb-3">
            <label class="form-label fw-bold">Calificaci\xF3n General de Salud:</label>
            <input type="range" id="calificacionSalud" class="form-range" min="0" max="100" value="50" />
            <span id="calificacionValor">50</span>
          </div>
  
          <!-- Cuadro de texto num\xE9rico -->
          <div class="mb-3">
            <label class="form-label fw-bold">D\xEDas estimados para pr\xF3xima revisi\xF3n:</label>
            <input type="number" id="diasParaRevisar" class="form-control" />
          </div>
  
          <!-- Switch -->
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="reservarConsulta" />
            <label class="form-check-label" for="reservarConsulta">\xBFReservar otra consulta?</label>
          </div>
  
          <div id="datos-dinamicos-container">
            <label class="form-label fw-bold">Datos Din\xE1micos (m\xE1ximo 3):</label>
            <div class="input-group mb-2">
              <input type="text" placeholder="Clave" class="form-control clave-dinamico" />
              <input type="text" placeholder="Valor" class="form-control valor-dinamico" />
            </div>
          </div>
          <button id="add-dynamic" class="btn btn-primary btn-sm w-100 mb-3">Agregar Dato Din\xE1mico</button>
        </div>
      `,showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Guardar",didOpen:()=>{let _=document.getElementById("calificacionSalud"),g=document.getElementById("calificacionValor");_?.addEventListener("input",()=>{g&&(g.textContent=_.value)})},preConfirm:()=>{e=document.getElementById("altura").value,n=document.getElementById("peso").value,i=document.getElementById("temperatura").value,o=document.getElementById("presion").value,l=+document.getElementById("calificacionSalud").value,u=document.getElementById("diasParaRevisar").value,T=document.getElementById("reservarConsulta").checked;let _=Array.from(document.querySelectorAll(".clave-dinamico")).map(f=>f.value.trim()),g=Array.from(document.querySelectorAll(".valor-dinamico")).map(f=>f.value.trim());if(_.forEach((f,w)=>{f&&g[w]&&E.push({clave:f,valor:g[w]})}),!e||!n||!i||!o||!u){b.default.showValidationMessage("Por favor completa todos los campos obligatorios.");return}if(_.length>3||g.length>3){b.default.showValidationMessage("Solo puedes agregar hasta 3 datos din\xE1micos.");return}if(_.some((f,w)=>f&&!g[w]||!f&&g[w])){b.default.showValidationMessage("Cada clave debe tener un valor correspondiente.");return}return{altura:e,peso:n,temperatura:i,presion:o,calificacionSalud:l,diasParaRevisar:u,reservarConsulta:T,datosDinamicos:E}}}).then(_=>{if(_.isConfirmed){let g=_.value;t.historiaClinica=g,this.firestoreService.updateDocument(`turnos/${t.id}`,{historiaClinica:g}).then(()=>{b.default.fire("Guardado","Historia cl\xEDnica guardada con \xE9xito.","success")})}})}static \u0275fac=function(e){return new(e||a)(D(re),D(ae),D(se))};static \u0275cmp=$({type:a,selectors:[["app-turnos-asignados"]],standalone:!0,features:[W],decls:31,vars:4,consts:[[1,"fondo"],[1,"container"],[1,"text-center","mt-4"],[1,"row","d-flex","justify-content-center","align-items-center","row-input","mb-2"],["type","text","placeholder","Buscar paciente o especialidad",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-center","mb-3"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-secondary","mx-4",3,"click"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"EstadoTurnoColor"],["class","btn btn-info btn-sm",3,"click",4,"ngIf"],["class","btn btn-success btn-sm mx-2",3,"click",4,"ngIf"],[1,"btn","btn-warning","btn-sm"],["disabled","",1,"btn","btn-secondary","btn-sm"],[1,"btn","btn-warning","btn-sm",3,"click"],[1,"btn","btn-info","btn-sm",3,"click"],[1,"btn","btn-success","btn-sm","mx-2",3,"click"],["class","btn btn-primary btn-sm mx-1",3,"click",4,"ngIf"],[1,"btn","btn-primary","btn-sm","mx-1",3,"click"],["class","btn btn-danger btn-sm",3,"click",4,"ngIf"],["class","btn btn-warning btn-sm mx-1",3,"click",4,"ngIf"],["class","btn btn-success btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"btn","btn-warning","btn-sm","mx-1",3,"click"],[1,"btn","btn-success","btn-sm",3,"click"],["colspan","7",1,"text-center"]],template:function(e,n){e&1&&(r(0,"section",0)(1,"div",1)(2,"h2",2),c(3,"Turnos Asignados"),s(),r(4,"div",3)(5,"input",4),G("ngModelChange",function(o){return q(n.buscar,o)||(n.buscar=o),o}),s()(),r(6,"div",5)(7,"button",6),C("click",function(){return n.cambiarSemana(!1)}),c(8,"Semana Actual"),s(),r(9,"button",7),C("click",function(){return n.cambiarSemana(!0)}),c(10,"Pr\xF3xima Semana"),s()(),r(11,"table",8)(12,"thead")(13,"tr")(14,"th"),c(15,"Paciente"),s(),r(16,"th"),c(17,"Especialidad"),s(),r(18,"th"),c(19,"D\xEDa"),s(),r(20,"th"),c(21,"Fecha"),s(),r(22,"th"),c(23,"Horarios"),s(),r(24,"th"),c(25,"Estado"),s(),r(26,"th"),c(27,"Acciones"),s()()(),r(28,"tbody"),y(29,Se,3,4,"ng-container",9)(30,we,3,0,"tr",10),s()()()()),e&2&&(p("@slideFlip",void 0),d(5),j("ngModel",n.buscar),d(24),p("ngForOf",n.diasDisponibles),d(),p("ngIf",!n.tieneTurnosAsignados()))},dependencies:[Q,U,J,K,ce,P,ie,ee,te,ne],styles:["h2[_ngcontent-%COMP%]{color:#036}.table[_ngcontent-%COMP%]{background-color:#fff}.text-muted[_ngcontent-%COMP%]{font-style:italic}.container[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}.fondo[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;align-items:center;margin:0;padding:0;background:linear-gradient(45deg,gold,#e48080);background-attachment:fixed;background-size:cover;background-repeat:no-repeat}"],data:{animation:[Z("slideFlip",[F(":enter",[M({transform:"translateX(-100%) rotateY(90deg)",opacity:0}),R("1000ms ease-out",M({transform:"translateX(0) rotateY(0)",opacity:1}))]),F(":leave",[R("1000ms ease-in",M({transform:"translateX(100%) rotateY(-90deg)",opacity:0}))])])]}})};export{le as TurnosAsignadosComponent};
