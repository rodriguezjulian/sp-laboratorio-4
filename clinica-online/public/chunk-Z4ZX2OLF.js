import{a as X}from"./chunk-NEDSM3HF.js";import{a as Q}from"./chunk-Z6TYFYPI.js";import{b as j,f as W,i as U,r as Z}from"./chunk-Y6YT2LEC.js";import{a as ie}from"./chunk-OLWY7DYE.js";import{c as H,d as w,f as v,i as B}from"./chunk-T7VJLMO5.js";import{F as K,u as G,z as J}from"./chunk-FMY7REJO.js";import{$b as P,Ab as x,Cb as d,Fc as R,Gc as $,Jc as O,Lc as q,Ob as c,Pb as M,Qb as F,Rb as k,Sb as z,Tb as L,Ua as l,Ub as V,Va as S,Wb as N,_b as I,ac as A,ha as D,hb as f,lb as p,pb as C,qa as _,ra as g,sb as a,tb as o,xb as h}from"./chunk-VJ2SRRAC.js";import{a as T,b as y,g as te,j as m}from"./chunk-4ZZIO3ZI.js";var u=te(ie());function ne(n,t){if(n&1){let e=h();a(0,"button",11),x("click",function(){_(e);let r=d().$implicit,s=d();return g(s.cancelarTurno(r))}),c(1," Cancelar "),o()}}function ae(n,t){if(n&1){let e=h();a(0,"button",14),x("click",function(){_(e);let r=d(2).$implicit,s=d();return g(s.completarEncuesta(r))}),c(1," Encuesta "),o()}}function oe(n,t){n&1&&(a(0,"button",13),c(1," Encuesta completada "),o())}function re(n,t){if(n&1&&f(0,ae,2,0,"button",12)(1,oe,2,0,"button",13),n&2){let e=d().$implicit;C(e.encuesta===""?0:1)}}function se(n,t){if(n&1){let e=h();a(0,"button",17),x("click",function(){_(e);let r=d(2).$implicit,s=d();return g(s.completarCalificacion(r))}),c(1," Calificar "),o()}}function ce(n,t){n&1&&(a(0,"button",16),c(1," Calificado "),o())}function le(n,t){if(n&1&&f(0,se,2,0,"button",15)(1,ce,2,0,"button",16),n&2){let e=d().$implicit;C(e.calificacion===""?0:1)}}function de(n,t){if(n&1){let e=h();a(0,"button",18),x("click",function(){_(e);let r=d().$implicit,s=d();return g(s.verResenia(r))}),c(1," Ver Rese\xF1a "),o()}}function ue(n,t){if(n&1&&(a(0,"tr")(1,"td"),c(2),o(),a(3,"td"),c(4),o(),a(5,"td"),c(6),o(),a(7,"td"),c(8),o(),a(9,"td",8)(10,"strong"),c(11),I(12,"titlecase"),o()(),a(13,"td"),f(14,ne,2,0,"button",9)(15,re,2,1)(16,le,2,1)(17,de,2,0,"button",10),o()()),n&2){let e=t.$implicit;l(2),k("",e.especialista.nombre," ",e.especialista.apellido,""),l(2),M(e.especialidad),l(2),M(e.fecha),l(2),k("",e.desde," - ",e.hasta,""),l(),p("EstadoTurnoColor",e.estado),l(2),F(" ",P(12,12,e.estado),""),l(3),p("ngIf",e.estado==="pendiente"),l(),C(e.estado.trim()==="Realizado"?15:-1),l(),C(e.estado.trim()==="Realizado"?16:-1),l(),p("ngIf",e.comentario&&(e.estado==="Realizado"||e.estado==="Cancelado"||e.estado==="Rechazado"))}}function me(n,t){n&1&&(a(0,"tr")(1,"td",19),c(2,"No se encontraron turnos."),o()())}var Y=class n{constructor(t,e){this.firestoreService=t;this.auth=e}usuarioLogueado=null;BuscarEspecialistaEspecialidad="";turnos=[];especialidadFiltro="";calificacion=0;comentario="";opinion="";preferencia=[];satisfaccion=50;especialistaFiltro="";estadosTurnos={pendiente:"Pendiente",cancelado:"Cancelado",realizado:"Realizado",rechazado:"Rechazado"};ngOnInit(){J(this.auth,t=>m(this,null,function*(){t&&(this.usuarioLogueado=t,console.log("quien esta ",this.usuarioLogueado),yield this.cargarTurnos())}))}cargarTurnos(){return m(this,null,function*(){if(this.usuarioLogueado)try{let t=yield this.firestoreService.getCollection("turnos",{where:[{field:"uidPaciente",op:"==",value:this.usuarioLogueado.uid}]});this.turnos=yield Promise.all(t.map(e=>m(this,null,function*(){let i=yield this.firestoreService.getDocument(`especialista/${e.uidEspecialista}`),r=i.exists()?i.data():{nombre:"Desconocido",apellido:""},s=yield this.firestoreService.getDocument(`especialidades/${e.uidEspecialidad}`),b=s.exists()?s.data():{descripcion:"Desconocida"};return y(T({},e),{especialista:r,especialidad:b.descripcion,comentario:e.comentario||""})}))),console.log("antes de ordenar por fecha ",this.turnos[0].fecha),this.turnos.sort((e,i)=>{let r=new Date(e.fecha).getTime(),s=new Date(i.fecha).getTime();if(r!==s)return r-s;let b=e.desde,E=i.desde;return b.localeCompare(E)}),console.log("Turnos obtenidos: ",this.turnos)}catch(t){console.error("Error al cargar los turnos:",t)}})}aplicarFiltros(){return this.turnos.filter(t=>{let e=!this.especialidadFiltro||t.especialidad.toLowerCase().includes(this.especialidadFiltro.toLowerCase()),i=!this.especialistaFiltro||`${t.especialista.nombre} ${t.especialista.apellido}`.toLowerCase().includes(this.especialistaFiltro.toLowerCase());return e&&i})}cancelarTurno(t){u.default.fire({title:"Cancelar Turno",input:"textarea",inputLabel:"Motivo de la cancelaci\xF3n",inputPlaceholder:"Escribe tu comentario...",showCancelButton:!0,confirmButtonText:"Cancelar Turno",cancelButtonText:"Cerrar"}).then(e=>m(this,null,function*(){if(e.isConfirmed&&e.value){let i=e.value.trim();console.log("comentarioss ",i),yield this.actualizarEstadoTurno(t,"Cancelado",i)}}))}actualizarEstadoTurno(t,e,i=""){return m(this,null,function*(){try{let r=y(T({},t),{estado:e,comentario:i});yield this.firestoreService.updateDocument(`turnos/${t.id}`,r),u.default.fire("\xC9xito","El turno fue cancelado exitosamente.","success"),yield this.cargarTurnos()}catch(r){console.error("Error al actualizar el turno:",r),u.default.fire("Error","No se pudo cancelar el turno. Intenta de nuevo.","error")}})}completarCalificacion(t){u.default.fire({title:"Completar Calificacion",input:"textarea",inputLabel:"D\xE9janos tu calificacion sobre el especialista:",inputPlaceholder:"Escribe aqu\xED...",showCancelButton:!0,confirmButtonText:"Enviar Calificacion"}).then(e=>m(this,null,function*(){if(e.isConfirmed&&e.value){let i=e.value.trim(),r=y(T({},t),{estado:"Realizado",calificacion:i});yield this.firestoreService.updateDocument(`turnos/${t.id}`,r),yield this.cargarTurnos()}}))}verResenia(t){console.log("ver resenia ",t),u.default.fire({title:"Rese\xF1a del Turno",text:t.comentario,icon:"info",confirmButtonText:"Cerrar"})}calificarAtencion(t){u.default.fire({title:"Calificar Atenci\xF3n",input:"textarea",inputLabel:"Describe c\xF3mo fue la atenci\xF3n del especialista:",inputPlaceholder:"Escribe tu opini\xF3n aqu\xED...",showCancelButton:!0,confirmButtonText:"Enviar Calificaci\xF3n"}).then(e=>m(this,null,function*(){if(e.isConfirmed&&e.value){let i=e.value.trim();yield this.actualizarEstadoTurno(t,"realizado",i)}}))}completarEncuesta(t){u.default.fire({title:"Encuesta de Satisfacci\xF3n",html:`
        <div class="container">
          <div class="mb-3">
            <label class="form-label fw-bold">\xBFNos recomendar\xEDas?</label><br>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="opinion" value="Si" id="opinionSi">
              <label class="form-check-label" for="opinionSi">S\xED</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="opinion" value="No" id="opinionNo">
              <label class="form-check-label" for="opinionNo">No</label>
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label fw-bold">Satisfacci\xF3n (1-10):</label>
            <input type="range" min="1" max="10" value="5" id="satisfaccionRange" class="form-range">
            <span id="satisfaccionValue" class="badge bg-primary">5</span>
          </div>
  
          <div class="mb-3">
            <label class="form-label fw-bold">Estrellas (0-5):</label>
            <input type="number" min="0" max="5" id="calificacionInput" class="form-control">
          </div>
  
          <div class="mb-3">
            <label class="form-label fw-bold">Comentario:</label>
            <textarea id="comentarioInput" class="form-control" rows="3"></textarea>
          </div>
        </div>
      `,showCancelButton:!0,confirmButtonText:"Enviar",preConfirm:()=>{let e=document.querySelector('input[name="opinion"]:checked')?.value||"",i=Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(ee=>ee.value),r=document.getElementById("satisfaccionRange")?.value,s=document.getElementById("calificacionInput")?.value,b=document.getElementById("comentarioInput")?.value,E={opinion:e,preferencia:i,satisfaccion:Number(r),calificacion:Number(s),comentario:b};if(!e||!s){u.default.showValidationMessage("Por favor completa todos los campos obligatorios.");return}return console.log("Datos de la encuesta:",E),E}}).then(e=>{e.isConfirmed&&(t.encuesta=e.value,this.firestoreService.updateDocument(`turnos/${t.id}`,{encuesta:e.value}),u.default.fire("\xA1Gracias!","Encuesta enviada con \xE9xito","success"))})}static \u0275fac=function(e){return new(e||n)(S(K),S(G))};static \u0275cmp=D({type:n,selectors:[["app-mis-turnos"]],standalone:!0,features:[N],decls:25,vars:7,consts:[[1,"fondo"],[1,"container"],[1,"text-center","mt-4"],[1,"row","d-flex","justify-content-center","align-items-center","row-input","mb-2"],["type","text","placeholder","Buscar especialista o especialidad","id","input-buscar-esp",1,"mb-2",3,"ngModelChange","ngModel"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"EstadoTurnoColor"],["class","btn btn-danger btn-sm",3,"click",4,"ngIf"],["class","btn btn-info btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"btn","btn-primary","btn-sm"],["disabled","",1,"btn","btn-secondary","btn-sm"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"btn","btn-primary","btn-sm","mx-2"],["disabled","",1,"btn","btn-secondary","btn-sm","mx-2"],[1,"btn","btn-primary","btn-sm","mx-2",3,"click"],[1,"btn","btn-info","btn-sm",3,"click"],["colspan","6",1,"text-center"]],template:function(e,i){e&1&&(a(0,"section",0)(1,"div",1)(2,"h2",2),c(3,"Mis Turnos"),o(),a(4,"div",3)(5,"input",4),V("ngModelChange",function(s){return L(i.BuscarEspecialistaEspecialidad,s)||(i.BuscarEspecialistaEspecialidad=s),s}),o()(),a(6,"table",5)(7,"thead")(8,"tr")(9,"th"),c(10,"Especialista"),o(),a(11,"th"),c(12,"Especialidad"),o(),a(13,"th"),c(14,"Fecha"),o(),a(15,"th"),c(16,"Horario"),o(),a(17,"th"),c(18,"Estado"),o(),a(19,"th"),c(20,"Acciones"),o()()(),a(21,"tbody"),f(22,ue,18,14,"tr",6),I(23,"buscarEspecialistaEspecialidad"),f(24,me,3,0,"tr",7),o()()()()),e&2&&(p("@pulseZoom",void 0),l(5),z("ngModel",i.BuscarEspecialistaEspecialidad),l(17),p("ngForOf",A(23,4,i.turnos,i.BuscarEspecialistaEspecialidad)),l(2),p("ngIf",i.aplicarFiltros().length===0))},dependencies:[q,R,$,O,Z,j,W,U,Q,X],styles:[".fondo[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;align-items:center;margin:0;padding:0;background:linear-gradient(45deg,gold,#e48080);background-attachment:fixed;background-size:cover;background-repeat:no-repeat}.table[_ngcontent-%COMP%]{margin-top:20px}.form-control[_ngcontent-%COMP%]{max-width:500px}#input-buscar-esp[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:4px;background-color:#fff;padding:10px;font-size:1rem;width:30%;transition:box-shadow .3s}"],data:{animation:[H("pulseZoom",[B(":enter",[v({transform:"scale(0)",opacity:0}),w("1000ms ease-in-out",v({transform:"scale(1.1)",opacity:1})),w("300ms ease-in-out",v({transform:"scale(1)"}))]),B(":leave",[w("1000ms ease-in-out",v({transform:"scale(0)",opacity:0}))])])]}})};export{Y as MisTurnosComponent};
