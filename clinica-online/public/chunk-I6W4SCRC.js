import{a as U}from"./chunk-Q33EZUCY.js";import{a as R}from"./chunk-W3H3FZ3L.js";import{b as j,f as A,j as V,s as $}from"./chunk-LDTLK62Q.js";import{a as K}from"./chunk-OLWY7DYE.js";import{a as H}from"./chunk-7FG5ZD4D.js";import{F as W}from"./chunk-JRXB4MSQ.js";import{Bb as M,Eb as P,Gb as _,Kc as F,Lc as L,Oc as z,Qc as N,Sb as o,Tb as p,Vb as v,Wa as c,Wb as O,Xa as C,Xb as D,Yb as B,_b as I,cc as f,dc as y,ec as k,ia as S,kb as E,ob as u,ra as w,sa as T,wb as t,xb as n}from"./chunk-SLHCDPS3.js";import{a as b,b as x,g as J,j as d}from"./chunk-4ZZIO3ZI.js";var g=J(K());function Q(l,a){if(l&1){let e=M();t(0,"button",9),P("click",function(){w(e);let r=_().$implicit,s=_();return T(s.CancelarTurno(r))}),o(1," Cancelar Turno "),n()}}function X(l,a){if(l&1&&(t(0,"tr")(1,"td"),o(2),n(),t(3,"td"),o(4),n(),t(5,"td"),o(6),n(),t(7,"td"),o(8),f(9,"titlecase"),n(),t(10,"td"),o(11),n(),t(12,"td",7)(13,"strong"),o(14),f(15,"titlecase"),n()(),t(16,"td"),E(17,Q,2,0,"button",8),n()()),l&2){let e=a.$implicit;c(2),v("",e.especialista.nombre," ",e.especialista.apellido,""),c(2),v("",e.paciente.nombre," ",e.paciente.apellido,""),c(2),p(e.fecha),c(2),p(y(9,10,e.especialidad)),c(3),p(e.desde),c(),u("EstadoTurnoColor",e.estado),c(2),p(y(15,12,e.estado)),c(3),u("ngIf",e.estado==="pendiente")}}var q=class l{constructor(a,e){this.firestoreService=a;this.loader=e}turnos=[];BuscarEspecialistaEspecialidad="";ngOnInit(){return d(this,null,function*(){console.log("sisi"),this.loader.setLoader(!0),yield this.cargarTurnos(),this.loader.setLoader(!1)})}cargarTurnos(){return d(this,null,function*(){try{let a=yield this.firestoreService.getCollection("turnos");this.turnos=yield Promise.all(a.map(e=>d(this,null,function*(){let i=yield this.firestoreService.getDocument(`especialista/${e.uidEspecialista}`),r=i.exists()?i.data():{nombre:"Desconocido",apellido:""},s=yield this.firestoreService.getDocument(`especialidades/${e.uidEspecialidad}`),h=s.exists()?s.data():{descripcion:"Desconocida"},m=yield this.firestoreService.getDocument(`paciente/${e.uidPaciente}`),G=m.exists()?m.data():{nombre:"Desconocida",apellido:"Desconocido"};return x(b({},e),{especialista:r,especialidad:h.descripcion,paciente:G})}))),this.turnos.sort((e,i)=>{let r=new Date(e.fecha).getTime(),s=new Date(i.fecha).getTime();if(r!==s)return r-s;let h=e.desde,m=i.desde;return h.localeCompare(m)}),console.log("Turnos obtenidos: ",this.turnos)}catch(a){console.error("Error al cargar los turnos:",a)}})}CancelarTurno(a){g.default.fire({title:"Cancelar Turno",input:"textarea",inputLabel:"Motivo de la cancelaci\xF3n",inputPlaceholder:"Escribe tu comentario...",showCancelButton:!0,confirmButtonText:"Cancelar Turno",cancelButtonText:"Cerrar"}).then(e=>d(this,null,function*(){if(e.isConfirmed&&e.value){let i=e.value.trim();yield this.actualizarEstadoTurno(a,"Cancelado",i)}}))}actualizarEstadoTurno(a,e,i=""){return d(this,null,function*(){try{let r=x(b({},a),{estado:e,comentario:i||a.comentario});yield this.firestoreService.updateDocument(`turnos/${a.id}`,r),g.default.fire("\xC9xito","El turno fue cancelado exitosamente.","success"),yield this.cargarTurnos()}catch(r){console.error("Error al actualizar el turno:",r),g.default.fire("Error","No se pudo cancelar el turno. Intenta de nuevo.","error")}})}static \u0275fac=function(e){return new(e||l)(C(W),C(H))};static \u0275cmp=S({type:l,selectors:[["app-turnos"]],standalone:!0,features:[I],decls:26,vars:5,consts:[[1,"container-fluid","cont-primary","fondo"],[1,"h2-turnos-clinica"],[1,"row","d-flex","justify-content-center","align-items-center","row-input","mb-2"],["type","text","placeholder","Buscar especialista o especialidad","id","input-buscar-esp",1,"mb-2",3,"ngModelChange","ngModel"],[1,"mb-5","row","d-flex","justify-content-center","align-items-start","row-table","fondotabla"],[1,"table-mis-horarios"],[4,"ngFor","ngForOf"],[3,"EstadoTurnoColor"],["class","btn btn-danger btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-danger","btn-sm",3,"click"]],template:function(e,i){e&1&&(t(0,"div",0)(1,"h2",1),o(2,"Turnos de la cl\xEDnica"),n(),t(3,"div",2)(4,"input",3),B("ngModelChange",function(s){return D(i.BuscarEspecialistaEspecialidad,s)||(i.BuscarEspecialistaEspecialidad=s),s}),n()(),t(5,"div",4)(6,"table",5)(7,"thead")(8,"tr")(9,"th"),o(10,"Especialista"),n(),t(11,"th"),o(12,"Paciente"),n(),t(13,"th"),o(14,"D\xEDa"),n(),t(15,"th"),o(16,"Especialidad"),n(),t(17,"th"),o(18,"Horario"),n(),t(19,"th"),o(20,"Estado"),n(),t(21,"th"),o(22,"Acci\xF3n"),n()()(),t(23,"tbody"),E(24,X,18,14,"tr",6),f(25,"buscarEspecialistaEspecialidad"),n()()()()),e&2&&(c(4),O("ngModel",i.BuscarEspecialistaEspecialidad),c(20),u("ngForOf",k(25,2,i.turnos,i.BuscarEspecialistaEspecialidad)))},dependencies:[N,F,L,z,$,j,A,V,U,R],styles:[".fondo[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;margin:0;padding:0;background:linear-gradient(45deg,gold,#e48080);background-attachment:fixed;background-size:cover;background-repeat:no-repeat}.fondotabla[_ngcontent-%COMP%]{background-color:#fff;margin:0 15%;padding:15px;border-radius:8px;box-shadow:0 4px 8px #0003}.table-mis-horarios[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background-color:#fff}.table-mis-horarios[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table-mis-horarios[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 15px;border-bottom:1px solid #ddd;text-align:center}.table-mis-horarios[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.table-mis-horarios[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f4f4f4;text-transform:uppercase;font-weight:700}.table-mis-horarios[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}.h2-turnos-clinica[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-size:2rem;color:#333;text-shadow:0 2px 3px rgba(0,0,0,.2);margin-bottom:20px}#input-buscar-esp[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:4px;background-color:#fff;padding:10px;font-size:1rem;width:30%;transition:box-shadow .3s}#input-buscar-esp[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 10px #0003}"]})};export{q as TurnosComponent};
